<!DOCTYPE html>
<!--
 * Adapted from: https://github.com/c0c0n3/c0c0n3.github.io/blob/master/index.html
 * (commit: https://github.com/c0c0n3/c0c0n3.github.io/commit/7bc099eb27309ee19b9bff5b8fcd0fc2985f3623) 
-->
<html lang="en">
<head>
  <title>Linux Daemon</title>
  
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link rel="stylesheet" type="text/css" href="http://necolas.github.io/normalize.css/latest/normalize.css" />
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Alegreya" />
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Kaushan+Script" />
  <link rel="stylesheet" type="text/css" href="../../css/style.css" />
  <link rel="stylesheet" type="text/css" href="../../css/zenburn-highlighter.css" />
  
</head>

<body>

<nav>
  <ul>
    <li><em>smuggler</em></li>
    <li><a href="../../content/index.html">home</a></li>
    <li><a href="https://github.com/c0c0n3/ome-smuggler">github</a></li>
    <li><a href="../../content/navigation.svg">site navigation</a></li>
  </ul>
</nav>

<header>
  <section id="header">
    <h1 id="title">Linux Daemon</h1>

    <p id="slogan">kinda scary!</p>

  </section>
</header>

<main>
  <section id="content">
  <p class="intro">
No, not an evil spirit. Rather a wicked “fully executable” jar to run Smuggler as a Linux service.
</p>
<p>This distro comes with a Spring Boot “fully executable” jar you can use to run Smuggler either as a System V (<code>init</code>) daemon or <code>systemd</code> service. This executable jar is just the Smuggler self-contained jar prepended with a startup script. No black magic.</p>
<h2 id="service-account">Service Account</h2>
<p>Decide what account to use to run Smuggler. Ideally, you should use an unprivileged user with no shell access. For example the command below creates both a group named <code>smuggler</code> and a user with the same name inside this new group while making sure the user has no shell access.</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">sudo</span> useradd -r -s /usr/bin/nologin smuggler -U</code></pre></div>
<p>Of course, YMMV.</p>
<h2 id="unpacking">Unpacking</h2>
<p>Now unpack the distro tarball. You could extract the contents to <code>/opt</code>, for example</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">sudo</span> tar xzf ome-smuggler-linux-daemon-*tgz -C /opt</code></pre></div>
<p>or to any other directory as appropriate for your system. Either way, you should now see an <code>ome-smuggler</code> directory with the following in it</p>
<ul>
<li><code>ome-smuggler-*.exe.jar</code>: the Spring Boot executable jar.</li>
<li><code>ome-smuggler-*.exe.conf</code>: Spring Boot configuration file for the startup script embedded into the executable jar.</li>
<li><code>ome-cli-*.jar</code>: the app Smuggler uses to run imports.</li>
<li><code>LICENSE.md</code>, <code>README.md</code>: can you guess what these are yet?</li>
</ul>
<p>You need to make your service user/group own this <code>ome-smuggler</code> directory. For example, if you have a user and group both named <code>smuggler</code></p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">cd</span> /opt
$ <span class="kw">sudo</span> chown smuggler:smuggler ome-smuggler</code></pre></div>
<p>And as we’re at it, let’s raise the security bar even more:</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash">$ <span class="kw">sudo</span> chmod 500 ome-smuggler/ome-smuggler-*.exe.jar
$ <span class="kw">sudo</span> chmod 400 ome-smuggler/ome-cli-*.jar
$ <span class="kw">sudo</span> chattr +i ome-smuggler/*.jar</code></pre></div>
<p>Over and above these basic things, you should also do whatever additional hardening advised by your system security guidelines.</p>
<h2 id="minimal-configuration">Minimal Configuration</h2>
<p>Smuggler uses three directories during his operation: one for configuration, one for data related to task processing, and one for logs. (Details in the <a href="configuration.html" title="Configuration">configuration</a> section.) The Linux daemon is pre-configured to create a data and log directory inside <code>ome-smuggler</code>—i.e. the directory you unpacked earlier—and to read your configuration from a <code>config</code> directory also inside <code>ome-smuggler</code>. The horror! But you can make the daemon follow Unix conventions in below a minute: just edit <code>ome-smuggler-*.exe.conf</code> to specify your directory layout. For example, a decent arrangement could be:</p>
<ul>
<li><code>/etc/opt/ome-smuggler.d</code> for your configuration directory;</li>
<li><code>/var/opt/ome-smuggler</code> for data; and</li>
<li><code>/var/log/ome-smuggler</code> for the logs.</li>
</ul>
<p>Smuggler will try to start an HTTP server on port <code>8000</code>. If that doesn’t suit you, stick an <code>undertow.yml</code> file in your configuration directory with this line in it:</p>
<div class="sourceCode"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="fu">port:</span> 8000</code></pre></div>
<p>but replace <code>8000</code> with the port number you want.</p>
<div class="pull-quote">
<h6 id="restart-required">Restart Required!</h6>
<p>Every time you change <em>any</em> of your configuration files you’ll have to stop and start the server again for the new configuration to take effect.</p>
</div>
<p>As for the mail configuration, Smuggler expects an SMTP service to be available on port <code>25</code> on <code>localhost</code>. If this is not the case, email notifications won’t go out (obviously!) but for the rest Smuggler will still work as advertised. Anyway, you can easily override the default mail configuration with your own: just provide a <code>mail.yml</code> file as explained in the <a href="configuration.html" title="Configuration">configuration</a> section.</p>
<h2 id="daemon-installation">Daemon Installation</h2>
<p>At this point you’re ready to hook the fully executable jar into <code>init.d</code> or <code>systemd</code>. The <a href="http://docs.spring.io/spring-boot/docs/current-SNAPSHOT/reference/html/deployment-install.html" title="Installing Spring Boot Applications">installation instructions</a> in the Spring Boot manual explain how to do that.</p>
  </section>
</main>  

<footer>
  <section id="footer">
    <p>
      <a href="../../content/index.html">home</a> • 
      <a href="https://github.com/c0c0n3/ome-smuggler">github</a> • 
      <a href="../../content/navigation.svg">site navigation</a>
    </p>
    <p>generated with <a href="https://jaspervdj.be/hakyll/">Hakyll</a> •  
      <a href="https://github.com/c0c0n3/ome-smuggler/tree/gh-pages">source code</a>
    </p> 
    <!-- TODO fonts; legal? -->
  </section>
</footer>
  
</body>
</html>
