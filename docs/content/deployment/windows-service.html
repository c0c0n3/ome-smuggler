<!DOCTYPE html>
<!--
 * Adapted from: https://github.com/c0c0n3/c0c0n3.github.io/blob/master/index.html
 * (commit: https://github.com/c0c0n3/c0c0n3.github.io/commit/7bc099eb27309ee19b9bff5b8fcd0fc2985f3623) 
-->
<html lang="en">
<head>
  <title>Windows Service</title>
  
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->
  <link rel="stylesheet" type="text/css" href="http://necolas.github.io/normalize.css/latest/normalize.css" />
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Alegreya" />
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Kaushan+Script" />
  <link rel="stylesheet" type="text/css" href="../../css/style.css" />
  <link rel="stylesheet" type="text/css" href="../../css/zenburn-highlighter.css" />
  
</head>

<body>

<nav>
  <ul>
    <li><em>smuggler</em></li>
    <li><a href="../../content/index.html">home</a></li>
    <li><a href="https://github.com/c0c0n3/ome-smuggler">github</a></li>
    <li><a href="../../content/navigation.svg">site navigation</a></li>
  </ul>
</nav>

<header>
  <section id="header">
    <h1 id="title">Windows Service</h1>

    <p id="slogan">easy peasy!</p>

  </section>
</header>

<main>
  <section id="content">
  <p class="intro">
A native wrapper to run Smuggler as a Windows service. Makes it easier to install, run and manage Smuggler on Windows.
</p>
<p>So we’ve got a .NET program (a customised <a href="https://github.com/kohsuke/winsw" title="winsw">winsw</a>) to control Smuggler on Windows—just in case you felt things were getting out of control. It has no GUI, but it comes with the usual commands you’d expect (start, stop, etc.) as well as commands to (un-)install Smuggler as a service. So you can run Smuggler as a Windows service and manage it using existing admin tools (e.g. Services GUI, <code>net</code> command) but you still have an option to run straight from the command line if for some reason you need to do that.</p>
<h2 id="directory-layout">Directory Layout</h2>
<p>Unzip the distribution bundle. You should see an <code>ome-smuggler</code> directory with license and README files as well as the following sub-directories</p>
<ul>
<li><code>bin</code>: contains the Windows service wrapper (<code>ome-smuggler.exe</code>) along with the wrapper’s own configuration files.</li>
<li><code>config</code>: where to put your configuration files; initially empty.</li>
<li><code>data</code>: files Smuggler generates as part of his operation; initially empty.</li>
<li><code>lib</code>: the entirety of Java byte-code that makes up the Smuggler app.</li>
<li><code>log</code>: where Smuggler writes log files; initially empty.</li>
</ul>
<p>The wrapper will write some files to the <code>bin</code> directory: its own log file, a file with Smuggler’s redirected <code>stdout</code> and one for Smuggler’s <code>stderr</code>. These files really belong in the <code>log</code> directory, but I didn’t have time to change this. (But I welcome any contribution if you want to change that!) The wrapper will also log start up and shutdown events to the Windows event log—under “Windows Logs/Application” with a source name of “smuggler”. Ideally all the info that can be useful to sys admins should also go in the Windows event log, but again I had no time for this. (Contributions are most welcome though!)</p>
<p>Note that this distribution packages Smuggler as a self-contained app with everything in the <code>ome-smuggler</code> directory: binaries, libraries, configuration, and any data that Smuggler will produce while running. You can easily change this though, just read on.</p>
<h2 id="minimal-configuration">Minimal Configuration</h2>
<p>Smuggler will try to start an HTTP server on port <code>8000</code>. If that doesn’t suit you, stick an <code>undertow.yml</code> file in the <code>config</code> directory with this line in it:</p>
<div class="sourceCode"><pre class="sourceCode yaml"><code class="sourceCode yaml"><span class="fu">port:</span> 8000</code></pre></div>
<p>but replace <code>8000</code> with the port number you want.</p>
<div class="pull-quote">
<h6 id="restart-required">Restart Required!</h6>
<p>Every time you change <em>any</em> of your configuration files you’ll have to stop and start the server again for the new configuration to take effect.</p>
</div>
<p>As for the mail configuration, Smuggler expects an SMTP service to be available on port <code>25</code> on <code>localhost</code>. If this is not the case, email notifications won’t go out (obviously!) but for the rest Smuggler will still work as advertised. Anyway, you can easily override the default mail configuration with your own: just provide a <code>config/mail.yml</code> file as explained in the <a href="configuration.html" title="Configuration">configuration</a> section.</p>
<h2 id="advanced-configuration">Advanced Configuration</h2>
<p>You have many more options to tweak the way Smuggler works, just have a read through the <a href="configuration.html" title="Configuration">configuration</a> section to see what’s available. Over and above that, there are some configuration settings specific to the Windows service wrapper that you can change by editing <code>bin\ome-smuggler.xml</code>.</p>
<h6 id="java-command">Java Command</h6>
<p>The wrapper launches Smuggler using the <code>java</code> command in the system <code>PATH</code>. You can change this by editing the <code>executable</code> tag.</p>
<h6 id="directory-layout-1">Directory Layout</h6>
<p>If you want to change the location of any of the data, log or configuration directories, edit the corresponding Java property in the <code>arguments</code> tag. Alternatively, you could delete the Java property and use an environment variable instead—details in the <a href="configuration.html" title="Configuration">configuration</a> section.</p>
<h6 id="service-priority">Service Priority</h6>
<p>The Smuggler service runs with a process priority class of “Normal”. To change that, put one of these values (case insensitive) in the <code>priority</code> tag: <code>Idle</code>, <code>BelowNormal</code>, <code>Normal</code>, <code>AboveNormal</code>, <code>High</code>, <code>RealTime</code>. But we don’t recommend using <code>Idle</code> or <code>BelowNormal</code> as they make the service unresponsive. More about priorities <a href="https://msdn.microsoft.com/en-us/library/system.diagnostics.processpriorityclass(v=vs.110).aspx" title="ProcessPriorityClass Enumeration">here</a> and over <a href="https://msdn.microsoft.com/en-us/library/windows/desktop/ms685100(v=vs.85).aspx" title="Scheduling Priorities">here</a> too.</p>
<h2 id="windows-service-installation">Windows Service Installation</h2>
<p>Now install Smuggler as a Windows service. Open a command prompt as a sys admin (right click on icon, then select “Run as administrator”) and go to the <code>ome-smuggler\bin</code> directory. From inside the <code>bin</code> directory run</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">&gt;</span> <span class="kw">ome-smuggler.exe</span> install</code></pre></div>
<p>Yip, this does exactly what you think: it sets up Smuggler as a service. Note that you <em>really</em> need to run this command inside <code>bin</code>. (Otherwise configuration, data, and log directories will point to the wrong place; have a look at the <code>APP_HOME</code> variable defined in <code>ome-smuggler.xml</code>.) The installer configures the service to start automatically at boot, if you want to start it immediately run</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">&gt;</span> <span class="kw">ome-smuggler.exe</span> start</code></pre></div>
<div class="pull-quote">
<h6 id="security-considerations">Security Considerations</h6>
<p>By default the service runs in the context of the <code>LocalSystem</code> account. You may want to consider using a less privileged account such as the <code>LocalService</code> account or a custom account. Pass the <code>install</code> command a <code>/p</code> option to specify the account details interactively at install time. Note that if you use a different account, that account will need to be able to access Smuggler’s configuration, data, and log directories and read/write files inside them.</p>
</div>
<p>Even though Smuggler is now going to have a life of its own as a service, you can still control it from the command line—have a look at the next section for the available commands. To uninstall the service, run</p>
<div class="sourceCode"><pre class="sourceCode bash"><code class="sourceCode bash"><span class="kw">&gt;</span> <span class="kw">ome-smuggler.exe</span> stop
<span class="kw">&gt;</span> <span class="kw">ome-smuggler.exe</span> uninstall</code></pre></div>
<p>And to wipe Smuggler out from the face of the earth, just delete the <code>ome-smuggler</code> directory. (If you changed the locations of Smuggler’s configuration, data and log directories to be outside of <code>ome-smuggler</code>, you’ll also have to delete those directories.)</p>
<h2 id="command-line-usage">Command Line Usage</h2>
<p>The <code>ome-smuggler.exe</code> wrapper can be used both to install and control the Smuggler service. As an installer, it takes these command arguments</p>
<ul>
<li><code>install</code>. Installs Smuggler as a Windows service. Followed by <code>/p</code>, it prompts you for the credentials of the account to use for running the Windows service.</li>
<li><code>uninstall</code>. Removes the Smuggler service from Windows system configuration. You’ll have to delete the <code>ome-smuggler</code> directory yourself.</li>
</ul>
<p>After installing the service, the following commands can be used to control it:</p>
<ul>
<li><code>start</code>. Starts the Smuggler service.</li>
<li><code>stop</code>. Stops the Smuggler service.</li>
<li><code>restart</code>. Restarts the Smuggler service.</li>
</ul>
<p>Additionally, there’s a command to report on service status:</p>
<ul>
<li><code>status</code>. Outputs one of the following status flags: <code>NonExistent</code> (service not installed yet), <code>Started</code> (service’s running), <code>Stopped</code> (service installed but not running).</li>
</ul>
  </section>
</main>  

<footer>
  <section id="footer">
    <p>
      <a href="../../content/index.html">home</a> • 
      <a href="https://github.com/c0c0n3/ome-smuggler">github</a> • 
      <a href="../../content/navigation.svg">site navigation</a>
    </p>
    <p>generated with <a href="https://jaspervdj.be/hakyll/">Hakyll</a> •  
      <a href="https://github.com/c0c0n3/ome-smuggler/tree/gh-pages">source code</a>
    </p> 
    <!-- TODO fonts; legal? -->
  </section>
</footer>
  
</body>
</html>
