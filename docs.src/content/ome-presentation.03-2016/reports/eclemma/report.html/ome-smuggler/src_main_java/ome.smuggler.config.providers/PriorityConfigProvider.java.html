<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>PriorityConfigProvider.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Smuggler All Tests (Mar 29, 2016 9:20:39 AM)</a> &gt; <a href="../../index.html" class="el_group">ome-smuggler</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">ome.smuggler.config.providers</a> &gt; <span class="el_source">PriorityConfigProvider.java</span></div><h1>PriorityConfigProvider.java</h1><pre class="source lang-java linenums">package ome.smuggler.config.providers;

import static util.spring.io.ResourceLocation.classpath;
import static util.spring.io.ResourceLocation.filepathFromCwd;

import java.util.stream.Stream;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.core.io.ResourceLoader;

import util.config.ConfigProvider;
import util.spring.io.FifoResource;
import util.spring.io.ResourceLocation;


/**
 * Base class for {@link ConfigProvider} beans that prioritize where 
 * configuration is read from.
 * This class first attempts to read configuration items from a file named
 * {@code fn} in the current working directory, where {@code fn} is the value 
 * returned by the {@link #getConfigFileName() getConfigFileName} method; if no
 * such file is found there, then an attempt is made to read the file from the 
 * class path at {@code /config/fn}. Failing that, if {@link #getFallback() 
 * fall-back} configuration has been specified, then those items are returned; 
 * otherwise an empty stream is returned, meaning no configuration is available.  
 */
<span class="fc" id="L27">public abstract class PriorityConfigProvider&lt;T&gt; </span>
    extends FifoResource&lt;T&gt; implements ConfigProvider&lt;T&gt; {

    @Autowired
    private ResourceLoader resourceLoader;

    @Override
    protected ResourceLoader getResourceLoader() {
<span class="fc" id="L35">        return resourceLoader;</span>
    } 
    
    /**
     * Subclasses implement this method to specify the name of the configuration
     * file to read data from. 
     * @return the configuration file name, e.g. 'my.config'.
     */
    public abstract String getConfigFileName();
    
    /**
     * Reads all the objects in the configuration file.
     * @return all configured objects; the stream may be empty but never 
     * {@code null}.
     */
    @Override
    public Stream&lt;T&gt; readConfig() throws Exception {
<span class="fc" id="L52">        String fileName = getConfigFileName();</span>
<span class="fc" id="L53">        ResourceLocation tryCwdFirst = filepathFromCwd(fileName);</span>
<span class="fc" id="L54">        ResourceLocation thenClasspath = classpath(&quot;config&quot;, fileName);</span>
        
<span class="fc" id="L56">        return read(tryCwdFirst, thenClasspath);</span>
    }

    /**
     * Reads configuration from the first available out of the specified 
     * locations, falling back to hard-coded configuration if no file is 
     * available.
     */
    public Stream&lt;T&gt; readConfig(ResourceLocation... loci)
            throws Exception {
<span class="fc" id="L66">        return read(loci);</span>
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>Smuggler All Tests (Mar 29, 2016 9:20:39 AM)</div></body></html>