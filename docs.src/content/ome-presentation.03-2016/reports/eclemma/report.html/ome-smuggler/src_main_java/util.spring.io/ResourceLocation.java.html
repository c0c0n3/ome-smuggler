<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>ResourceLocation.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Smuggler All Tests (Mar 29, 2016 9:20:39 AM)</a> &gt; <a href="../../index.html" class="el_group">ome-smuggler</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">util.spring.io</a> &gt; <span class="el_source">ResourceLocation.java</span></div><h1>ResourceLocation.java</h1><pre class="source lang-java linenums">package util.spring.io;

import static java.util.stream.Collectors.joining;
import static util.sequence.Arrayz.hasNulls;
import static util.sequence.Arrayz.isNullOrZeroLength;

import java.net.URI;
import java.net.URISyntaxException;
import java.util.Arrays;
import java.util.stream.Stream;

import org.springframework.core.io.ResourceLoader;

import util.object.AbstractWrapper;

/**
 * A Spring resource location. 
 * This is, in general, a better alternative to using plain strings to locate
 * resources. 
 */
public class ResourceLocation extends AbstractWrapper&lt;String&gt; {

    /**
     * Builds a relative path location string from the path.
     * E.g. {@code relpath(&quot;x&quot;, &quot;y&quot;) =&gt; x/y}.
     * @param pathComponents the path components. They will be converted to a
     * string using their {@code toString} method; any resulting empty string
     * will be removed from the path.
     * @return the location.
     * @throws IllegalArgumentException if the path component array is {@code 
     * null} or empty, or any of the path components is {@code null}, or all
     * path components evaluate to the empty string, or the path is not that 
     * of a valid {@link URI}.
     */
    public static ResourceLocation relpath(Object...pathComponents) {
<span class="fc" id="L36">        return new ResourceLocation(&quot;&quot;, false, pathComponents);</span>
    }
    
    /**
     * Builds a file location string from the path.
     * E.g. {@code filepath(&quot;x&quot;, &quot;y&quot;) =&gt; file:/x/y}.
     * @param pathComponents the path components. They will be converted to a
     * string using their {@code toString} method; any resulting empty string
     * will be removed from the path.
     * @return the location.
     * @throws IllegalArgumentException if the path component array is {@code 
     * null} or empty, or any of the path components is {@code null}, or all
     * path components evaluate to the empty string, or the path is not that 
     * of a valid {@link URI}.
     */
    public static ResourceLocation filepath(Object...pathComponents) {
<span class="fc" id="L52">        return new ResourceLocation(&quot;file:&quot;, pathComponents);</span>
    }
    
    /**
     * Builds a relative file location string from the path; the path is 
     * interpreted relative to the current working directory.
     * E.g. {@code filepathFromCwd(&quot;x&quot;, &quot;y&quot;) =&gt; file:./x/y}.
     * @param pathComponents the path components. They will be converted to a
     * string using their {@code toString} method; any resulting empty string
     * will be removed from the path.
     * @return the location.
     * @throws IllegalArgumentException if the path component array is {@code 
     * null} or empty, or any of the path components is {@code null}, or all
     * path components evaluate to the empty string, or the path is not that 
     * of a valid {@link URI}.
     */
    public static ResourceLocation filepathFromCwd(Object...pathComponents) {
<span class="fc" id="L69">        return new ResourceLocation(&quot;file:.&quot;, pathComponents);</span>
    }
    
    /**
     * Builds a classpath location string from the path.
     * E.g. {@code classpath(&quot;x&quot;, &quot;y&quot;) =&gt; classpath:/x/y}.
     * @param pathComponents the path components. They will be converted to a
     * string using their {@code toString} method; any resulting empty string
     * will be removed from the path.
     * @return the location.
     * @throws IllegalArgumentException if the path component array is {@code 
     * null} or empty, or any of the path components is {@code null}, or all
     * path components evaluate to the empty string, or the path is not that 
     * of a valid {@link URI}.
     */
    public static ResourceLocation classpath(Object...pathComponents) {
<span class="fc" id="L85">        return new ResourceLocation(ResourceLoader.CLASSPATH_URL_PREFIX, </span>
<span class="fc" id="L86">                                    pathComponents);</span>
    }
    
    private static String build(String scheme, 
                                boolean absolute, 
                                Object...pathComponents) {
<span class="fc" id="L92">        String schemeSpecificPart = buildPath(absolute, pathComponents);</span>
        try {
<span class="fc" id="L94">            URI location = new URI(scheme + schemeSpecificPart);</span>
<span class="fc" id="L95">            return location.toString();</span>
<span class="nc" id="L96">        } catch (URISyntaxException e) {</span>
<span class="nc" id="L97">            String msg = String.format(&quot;%s: %s [%s]&quot;, </span>
<span class="nc" id="L98">                    &quot;invalid path&quot;, schemeSpecificPart, e.getMessage());</span>
<span class="nc" id="L99">            throw new IllegalArgumentException(msg, e);</span>
        } 
    }
    
    private static String buildPath(boolean absolute, Object...pathComponents) {
<span class="fc bfc" id="L104" title="All 2 branches covered.">        if (isNullOrZeroLength(pathComponents)) {</span>
<span class="fc" id="L105">            throw new IllegalArgumentException(&quot;no path components&quot;);</span>
        }
<span class="fc bfc" id="L107" title="All 2 branches covered.">        if (hasNulls(pathComponents)) {</span>
<span class="fc" id="L108">            String msg = String.format(&quot;%s: %s&quot;, </span>
<span class="fc" id="L109">                                       &quot;some path components are null&quot;, </span>
<span class="fc" id="L110">                                       Arrays.toString(pathComponents));</span>
<span class="fc" id="L111">            throw new IllegalArgumentException(msg);</span>
        }
        
<span class="fc" id="L114">        String joined = Stream.of(pathComponents)</span>
<span class="fc" id="L115">                              .map(Object::toString)</span>
<span class="fc bfc" id="L116" title="All 2 branches covered.">                              .filter(s -&gt; !s.isEmpty())</span>
<span class="fc" id="L117">                              .collect(joining(&quot;/&quot;));</span>
        
<span class="fc bfc" id="L119" title="All 2 branches covered.">        if (joined.isEmpty()) {</span>
<span class="fc" id="L120">            throw new IllegalArgumentException(&quot;all path components are empty&quot;);</span>
        }
        
<span class="fc bfc" id="L123" title="All 2 branches covered.">        return absolute ? &quot;/&quot; + joined : joined;</span>
    }

    private final String location;
    
    private ResourceLocation(String scheme, Object...pathComponents) {
<span class="fc" id="L129">        this(scheme, true, pathComponents);</span>
<span class="fc" id="L130">    }</span>

<span class="fc" id="L132">    private ResourceLocation(String scheme, </span>
                             boolean absolutePath, 
                             Object...pathComponents) {
<span class="fc" id="L135">        location = build(scheme, absolutePath, pathComponents);</span>
<span class="fc" id="L136">    }</span>
    
    @Override
    public String get() {
<span class="fc" id="L140">        return location;</span>
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>Smuggler All Tests (Mar 29, 2016 9:20:39 AM)</div></body></html>