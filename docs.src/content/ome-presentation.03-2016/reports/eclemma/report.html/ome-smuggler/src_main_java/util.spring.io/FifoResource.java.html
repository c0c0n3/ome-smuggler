<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../../../.resources/report.css" type="text/css"/><link rel="shortcut icon" href="../../../.resources/report.gif" type="image/gif"/><title>FifoResource.java</title><link rel="stylesheet" href="../../../.resources/prettify.css" type="text/css"/><script type="text/javascript" src="../../../.resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../../../.sessions.html" class="el_session">Sessions</a></span><a href="../../../index.html" class="el_report">Smuggler All Tests (Mar 29, 2016 9:20:39 AM)</a> &gt; <a href="../../index.html" class="el_group">ome-smuggler</a> &gt; <a href="../index.html" class="el_bundle">src/main/java</a> &gt; <a href="index.source.html" class="el_package">util.spring.io</a> &gt; <span class="el_source">FifoResource.java</span></div><h1>FifoResource.java</h1><pre class="source lang-java linenums">package util.spring.io;

import java.util.stream.Stream;

import org.springframework.core.io.ResourceLoader;


/**
 * Converts resource data into objects using a &quot;first-available&quot; strategy to 
 * determine from which location to load resource data with an option to fall
 * back to a predefined stream of objects if no resource data can be fetched 
 * from the specified resource locations.
 * The functionality is provided by the {@link #read(ResourceLocation...) read} 
 * template method. Subclasses have to fill in a {@link #getResourceLoader() 
 * resource loader} and a {@link #getConverter() resource reader} to convert 
 * resource data into objects; optionally a subclass may provide {@link 
 * #getFallback() fall-back} objects.  
 */
<span class="fc" id="L19">public abstract class FifoResource&lt;T&gt; {</span>

    /**
     * Subclasses implement this method to provide a {@link ResourceLoader} to
     * access resources when {@link #read(ResourceLocation...) reading}
     * configuration in.
     * @return the resource loader to use.
     */
    protected abstract ResourceLoader getResourceLoader();
    
    /**
     * Subclasses implement this method to provide a {@link ResourceReader} to
     * convert resource data when {@link #read(ResourceLocation...) reading} 
     * data in.
     * @return the resource reader to use.
     */
    protected abstract ResourceReader&lt;T&gt; getConverter();
    
    /**
     * Subclasses may override this method to provide objects that the {@link 
     * #read(ResourceLocation...) read} method will return if no resource data
     * can be found in all of the specified resource locations.
     * @return the fall-back objects to use.
     */
    public Stream&lt;T&gt; getFallback() {
<span class="nc" id="L44">        return Stream.empty();</span>
    }

    /**
     * Reads objects from the first resource available out of the specified 
     * locations, optionally {@link #getFallback() falling back} to a given 
     * stream of objects if no resource is available.
     * @param loci where to look for resources.
     * @return the items read from the first available resource or the fall-back
     * items (if provided) as the case may be. The returned stream may be empty
     * (e.g. the resource stream holds no data, no fall-back items provided)
     * but will never be {@code null}.
     * @throws Exception if an error occurred while reading resource data.
     */
    public Stream&lt;T&gt; read(ResourceLocation...loci) throws Exception {
<span class="fc" id="L59">        ResourceLoader sourceLoader = getResourceLoader();</span>
<span class="fc" id="L60">        ResourceReader&lt;T&gt; converter = getConverter(); </span>
        
<span class="fc" id="L62">        return new FifoResourceLoaderAdapter(sourceLoader)</span>
<span class="fc" id="L63">                        .selectResource(loci)</span>
<span class="fc" id="L64">                        .map(converter::readResource)</span>
<span class="fc" id="L65">                        .orElse(getFallback());</span>
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.eclemma.org/jacoco">JaCoCo</a> 0.7.2.201409121644</span>Smuggler All Tests (Mar 29, 2016 9:20:39 AM)</div></body></html>